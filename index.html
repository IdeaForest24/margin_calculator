<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBay íŒë§¤ ë§ˆì§„ ê³„ì‚°ê¸° v1.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            background-color: #f9fafb;
            color: #374151;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            background-color: white;
            min-height: 100vh;
        }
        
        .header {
            margin-bottom: 32px;
        }
        
        .header h1 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 30px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 16px;
        }
        
        .version-badge {
            background: linear-gradient(45deg, #3b82f6, #16a34a);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .header p {
            color: #6b7280;
        }
        
        .top-bar {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 24px;
            align-items: center;
            margin-top: 16px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .top-bar {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }
        
        .exchange-rate-info {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .exchange-rate-info .rate {
            font-weight: 600;
            color: #1d4ed8;
        }
        
        .refresh-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .refresh-btn:hover {
            background: #2563eb;
        }
        
        .excel-upload-compact {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px dashed #0ea5e9;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 280px;
            cursor: pointer;
        }
        
        .excel-upload-compact:hover {
            border-color: #0284c7;
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
            transform: scale(1.02);
        }
        
        .excel-upload-compact .upload-icon {
            font-size: 24px;
            color: #0ea5e9;
            margin-bottom: 8px;
        }
        
        .excel-upload-compact .upload-text {
            font-size: 14px;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 4px;
        }
        
        .excel-upload-compact .upload-subtext {
            font-size: 12px;
            color: #64748b;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-status {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .upload-status.success {
            background: #dcfce7;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }
        
        .upload-status.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .upload-status.info {
            background: #eff6ff;
            color: #2563eb;
            border: 1px solid #dbeafe;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 32px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .section {
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .section.blue { background-color: #eff6ff; border-color: #dbeafe; }
        .section.orange { background-color: #fff7ed; border-color: #fed7aa; }
        .section.green { background-color: #f0fdf4; border-color: #bbf7d0; }
        .section.red { background-color: #fef2f2; border-color: #fecaca; }
        .section.yellow { background-color: #fffbeb; border-color: #fde68a; }
        .section.gray { background-color: #f9fafb; border-color: #e5e7eb; }
        .section.purple { background-color: #faf5ff; border-color: #e9d5ff; }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .section-header.blue { color: #1d4ed8; }
        .section-header.orange { color: #ea580c; }
        .section-header.green { color: #16a34a; }
        .section-header.red { color: #dc2626; }
        .section-header.yellow { color: #d97706; }
        .section-header.gray { color: #374151; }
        .section-header.purple { color: #9333ea; }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full {
            grid-column: span 2;
        }
        
        @media (max-width: 768px) {
            .form-group.full {
                grid-column: span 1;
            }
        }
        
        label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }
        
        input, select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .help-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .dimension-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }
        
        .info-box {
            font-size: 14px;
            color: #1d4ed8;
            background-color: #eff6ff;
            padding: 12px;
            border-radius: 6px;
            margin-top: 16px;
        }
        
        .calculate-btn {
            width: 100%;
            background: linear-gradient(to right, #2563eb, #16a34a);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .calculate-btn:hover {
            background: linear-gradient(to right, #1d4ed8, #15803d);
            transform: translateY(-1px);
        }
        
        .calculate-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .results-section {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 14px;
        }
        
        .result-item.header {
            font-weight: 600;
            font-size: 16px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }
        
        .result-item.total {
            font-weight: 600;
            font-size: 18px;
            border-top: 1px solid #e5e7eb;
            padding-top: 8px;
            margin-top: 8px;
        }
        
        .text-red { color: #dc2626; }
        .text-green { color: #16a34a; }
        .text-blue { color: #2563eb; }
        .text-gray { color: #6b7280; }
        .text-purple { color: #9333ea; }
        
        .hidden { display: none; }
        
        ul {
            list-style: none;
            padding-left: 0;
        }
        
        li {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .service-type-toggle {
            display: flex;
            background: #f3f4f6;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 16px;
        }
        
        .service-type-option {
            flex: 1;
            padding: 8px 16px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
        }
        
        .service-type-option.active {
            background: white;
            color: #1d4ed8;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .service-type-option:not(.active) {
            color: #6b7280;
        }
        
        .service-type-option:hover:not(.active) {
            background: #e5e7eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                ğŸ“ˆ eBay íŒë§¤ ë§ˆì§„ ê³„ì‚°ê¸° <span class="version-badge">v1.0</span>
            </h1>
            
            <!-- ìƒë‹¨ ë°”: í™˜ìœ¨ ì •ë³´ + ì—‘ì…€ ì—…ë¡œë“œ -->
            <div class="top-bar">
                <div class="exchange-rate-info">
                    <div>
                        <span>ğŸ’± ì‹¤ì‹œê°„ í™˜ìœ¨: </span>
                        <span class="rate" id="exchangeRateDisplay">1 USD = ë¡œë”©ì¤‘...</span>
                        <span id="lastUpdated" class="text-gray"></span>
                    </div>
                    <button class="refresh-btn" onclick="fetchExchangeRate()">
                        <span id="refreshIcon">ğŸ”„</span> ê°±ì‹ 
                    </button>
                </div>
                
                <div class="excel-upload-compact" id="uploadSection" onclick="document.getElementById('excelFile').click()">
                    <div class="upload-icon">ğŸ“‹</div>
                    <div class="upload-text">eGS ìš´ì„í‘œ ì—…ë¡œë“œ</div>
                    <div class="upload-subtext">ì—‘ì…€ íŒŒì¼ (.xlsx, .xls)</div>
                    <input type="file" id="excelFile" class="file-input" accept=".xlsx,.xls" onchange="handleFileUpload(event)">
                </div>
            </div>
            
            <!-- ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ -->
            <div id="uploadStatus" class="upload-status hidden"></div>
        </div>

        <div class="main-grid">
            <!-- ì…ë ¥ í¼ -->
            <div class="input-section">
                <!-- ì œí’ˆ ì›ê°€ ì •ë³´ -->
                <div class="section blue">
                    <div class="section-header blue">
                        ğŸ“¦ ì œí’ˆ ì›ê°€ ì •ë³´
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="productCost">ì œí’ˆ ì›ê°€ (ì›)</label>
                            <input type="number" id="productCost" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="supplierShipping">ë§¤ì…ì²˜ ë°°ì†¡ë¹„ (ì›)</label>
                            <input type="number" id="supplierShipping" placeholder="">
                        </div>
                    </div>
                </div>

                <!-- ìƒí’ˆ ì •ë³´ ë° ë°°ì†¡ -->
                <div class="section orange">
                    <div class="section-header orange">
                        ğŸšš ìƒí’ˆ ì •ë³´ ë° ë°°ì†¡
                    </div>
                    
                    <!-- ë°°ì†¡ ì„œë¹„ìŠ¤ ì„ íƒ -->
                    <div class="service-type-toggle">
                        <div class="service-type-option active" onclick="toggleServiceType('standard')">
                            ğŸš› eGS Standard (5-10ì¼)
                        </div>
                        <div class="service-type-option" onclick="toggleServiceType('express')">
                            âœˆï¸ eGS Express (2-5ì¼)
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="weight">ì‹¤ì œ ì¤‘ëŸ‰ (kg)</label>
                            <input type="number" step="0.1" id="weight" placeholder="ì˜ˆì‹œ : 0.5, 2">
                        </div>
                        <div class="form-group">
                            <label for="egsShipping">eGS ì°½ê³  ì…ê³ ë¹„ (ì›)</label>
                            <input type="number" id="egsShipping" value="" placeholder="ì˜ˆì‹œ : 3000, 3400">
                            <div class="help-text">GS25 ë°˜ê°’íƒë°° ìµœì €ìš”ê¸ˆ: 3,400ì›</div>
                        </div>
                    </div>
                    <div class="dimension-grid" style="margin-top: 16px;">
                        <div class="form-group">
                            <label for="length">ê°€ë¡œ (cm)</label>
                            <input type="number" id="length" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="width">ì„¸ë¡œ (cm)</label>
                            <input type="number" id="width" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="height">ë†’ì´ (cm)</label>
                            <input type="number" id="height" placeholder="">
                        </div>
                    </div>
                    <div id="weightInfo" class="info-box hidden"></div>
                </div>

                <!-- eBay íŒë§¤ ì •ë³´ -->
                <div class="section green">
                    <div class="section-header green">
                        ğŸŒ eBay íŒë§¤ ì •ë³´
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="destination">ëª©ì ì§€ *</label>
                            <select id="destination">
                                <option value="">ëª©ì ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="US">ë¯¸êµ­ (US)</option>
                                <option value="CA">ìºë‚˜ë‹¤ (CA)</option>
                                <option value="GB">ì˜êµ­ (GB)</option>
                                <option value="DE">ë…ì¼ (DE)</option>
                                <option value="FR">í”„ë‘ìŠ¤ (FR)</option>
                                <option value="IT">ì´íƒˆë¦¬ì•„ (IT)</option>
                                <option value="ES">ìŠ¤í˜ì¸ (ES)</option>
                                <option value="EU">ê¸°íƒ€ ìœ ëŸ½ (EU) - ë…ì¼ ìš”ê¸ˆ ì ìš©</option>
                                <option value="AU">í˜¸ì£¼ (AU)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="category">eBay ì¹´í…Œê³ ë¦¬ *</label>
                            <select id="category">
                                <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="most_categories">ëŒ€ë¶€ë¶„ ì¹´í…Œê³ ë¦¬ (ì¼ë°˜)</option>
                                <option value="books_movies_music">ë„ì„œ/ì˜í™”/ìŒì•…</option>
                                <option value="womens_bags">ì—¬ì„±ìš© ê°€ë°©/í•¸ë“œë°±</option>
                                <option value="athletic_shoes">ìš´ë™í™” (ë‚¨ì„±/ì—¬ì„±)</option>
                                <option value="jewelry_watches">ë³´ì„/ì‹œê³„ (ì¼ë°˜)</option>
                                <option value="watches_parts">ì‹œê³„/ë¶€í’ˆ/ì•¡ì„¸ì„œë¦¬</option>
                                <option value="coins_paper_money">ë™ì „/ì§€í (ê¸ˆê´´ì œì™¸)</option>
                                <option value="bullion">ê¸ˆê´´/ê·€ê¸ˆì†</option>
                                <option value="guitars_basses">ì•…ê¸° (ê¸°íƒ€/ë² ì´ìŠ¤)</option>
                                <option value="trading_cards">íŠ¸ë ˆì´ë”© ì¹´ë“œ</option>
                                <option value="nft_categories">NFT ì¹´í…Œê³ ë¦¬</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid" style="margin-top: 16px;">
                        <div class="form-group">
                            <label for="storeType">eBay ìŠ¤í† ì–´ êµ¬ë…</label>
                            <select id="storeType">
                                <option value="none">ìŠ¤í† ì–´ ì—†ìŒ/Starter</option>
                                <option value="basic">Basic ì´ìƒ ìŠ¤í† ì–´</option>
                            </select>
                            <div class="help-text">ìŠ¤í† ì–´ êµ¬ë… ì‹œ ìˆ˜ìˆ˜ë£Œ í• ì¸</div>
                        </div>
                        <div class="form-group">
                            <label for="isKoreanSeller">í•œêµ­ íŒë§¤ì ì—¬ë¶€</label>
                            <select id="isKoreanSeller">
                                <option value="true">í•œêµ­ íŒë§¤ì (VAT 10% ì ìš©)</option>
                                <option value="false">í•´ì™¸ íŒë§¤ì</option>
                            </select>
                            <div class="help-text">í•œêµ­ íŒë§¤ìëŠ” VAT 10% ì¶”ê°€</div>
                        </div>
                    </div>
                    <div class="form-group full" style="margin-top: 16px;">
                        <label for="targetMargin">ëª©í‘œ ë§ˆì§„ìœ¨ (%)</label>
                        <input type="number" step="1" id="targetMargin" value="" placeholder="ì˜ˆì‹œ : 20">
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateMargin()">
                    ğŸ§® ë§ˆì§„ ê³„ì‚°í•˜ê¸°
                </button>
            </div>

            <!-- ê²°ê³¼ -->
            <div class="results-section">
                <div id="resultsContainer" class="hidden">
                    <!-- ë¹„ìš© êµ¬ì¡° -->
                    <div class="section red">
                        <div class="section-header red">
                            ğŸ’° ë¹„ìš© êµ¬ì¡° (ì›í™”)
                        </div>
                        <div id="costBreakdown"></div>
                    </div>

                    <!-- íŒë§¤ ì •ë³´ -->
                    <div class="section green">
                        <div class="section-header green">
                            ğŸ“ˆ íŒë§¤ ì •ë³´ (USD)
                        </div>
                        <div id="salesInfo"></div>
                    </div>

                    <!-- ì„¤ì • ì •ë³´ -->
                    <div class="section blue">
                        <div class="section-header blue">
                            âš™ï¸ íŒë§¤ ì„¤ì • ì •ë³´
                        </div>
                        <div id="settingsInfo"></div>
                    </div>
                </div>

                <!-- ì‚¬ìš© ë°©ë²• -->
                <div class="section blue">
                    <div class="section-header blue">
                        ğŸ“– ì‚¬ìš© ë°©ë²•
                    </div>
                    <ul>
                        <li>â€¢ <strong>1ë‹¨ê³„:</strong> eGS ìš´ì„í‘œ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš” (ë“œë˜ê·¸&ë“œë¡­ ë˜ëŠ” í´ë¦­)</li>
                        <li>â€¢ <strong>2ë‹¨ê³„:</strong> ì œí’ˆ ì •ë³´(ì›ê°€, ì¤‘ëŸ‰, ì¹˜ìˆ˜)ë¥¼ ì…ë ¥í•˜ì„¸ìš”</li>
                        <li>â€¢ <strong>3ë‹¨ê³„:</strong> ë°°ì†¡ ëª©ì ì§€ì™€ eBay ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</li>
                        <li>â€¢ <strong>4ë‹¨ê³„:</strong> ëª©í‘œ ë§ˆì§„ìœ¨ì„ ì„¤ì •í•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</li>
                        <li>â€¢ ğŸ’¡ <strong>íŒ:</strong> í•œ ë²ˆ ì—…ë¡œë“œí•œ ìš´ì„í‘œëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì–´ ë‹¤ìŒì—ë„ ìë™ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentExchangeRate = 1300;
        let currentServiceType = 'standard';
        let egsRatesData = null; // ì—‘ì…€ì—ì„œ ë¡œë“œëœ ìš´ì„ ë°ì´í„°

        // eBay ì¹´í…Œê³ ë¦¬ë³„ ìˆ˜ìˆ˜ë£Œìœ¨
        const ebayCategories = {
            'most_categories': { 
                name: 'ëŒ€ë¶€ë¶„ ì¹´í…Œê³ ë¦¬ (ì¼ë°˜)', 
                noStore: { rate: 13.6, threshold: 7500, overRate: 2.35 },
                withStore: { rate: 12.7, threshold: 2500, overRate: 2.35 }
            },
            'books_movies_music': { 
                name: 'ë„ì„œ/ì˜í™”/ìŒì•…', 
                noStore: { rate: 15.3, threshold: 7500, overRate: 2.35 },
                withStore: { rate: 15.3, threshold: 2500, overRate: 2.35 }
            },
            'womens_bags': { 
                name: 'ì—¬ì„±ìš© ê°€ë°©/í•¸ë“œë°±', 
                noStore: { rate: 15.0, threshold: 2000, overRate: 9.0 },
                withStore: { rate: 13.0, threshold: 2000, overRate: 7.0 }
            },
            'athletic_shoes': { 
                name: 'ìš´ë™í™” (ë‚¨ì„±/ì—¬ì„±)', 
                noStore: { rate: 8.0, minAmount: 150, belowMinRate: 13.6 },
                withStore: { rate: 7.0, minAmount: 150, belowMinRate: 12.7 }
            },
            'jewelry_watches': { 
                name: 'ë³´ì„/ì‹œê³„ (ì¼ë°˜)', 
                noStore: { rate: 15.0, threshold: 5000, overRate: 9.0 },
                withStore: { rate: 13.0, threshold: 5000, overRate: 7.0 }
            },
            'watches_parts': { 
                name: 'ì‹œê³„/ë¶€í’ˆ/ì•¡ì„¸ì„œë¦¬', 
                noStore: { rate: 15.0, threshold1: 1000, rate1: 6.5, threshold2: 7500, rate2: 3.0 },
                withStore: { rate: 12.5, threshold1: 1000, rate1: 4.0, threshold2: 5000, rate2: 3.0 }
            },
            'coins_paper_money': { 
                name: 'ë™ì „/ì§€í (ê¸ˆê´´ì œì™¸)', 
                noStore: { rate: 13.25, threshold: 7500, overRate: 2.35 },
                withStore: { rate: 9.0, threshold: 4000, overRate: 2.35 }
            },
            'bullion': { 
                name: 'ê¸ˆê´´/ê·€ê¸ˆì†', 
                noStore: { rate: 13.6, threshold: 7500, overRate: 7.0 },
                withStore: { rate: 7.5, threshold1: 1500, rate1: 5.0, threshold2: 10000, rate2: 4.5 }
            },
            'guitars_basses': { 
                name: 'ì•…ê¸° (ê¸°íƒ€/ë² ì´ìŠ¤)', 
                noStore: { rate: 6.7, threshold: 7500, overRate: 2.35 },
                withStore: { rate: 6.7, threshold: 2500, overRate: 2.35 }
            },
            'trading_cards': { 
                name: 'íŠ¸ë ˆì´ë”© ì¹´ë“œ', 
                noStore: { rate: 13.25, threshold: 7500, overRate: 2.35 },
                withStore: { rate: 12.35, threshold: 2500, overRate: 2.35 }
            },
            'nft_categories': { 
                name: 'NFT ì¹´í…Œê³ ë¦¬', 
                noStore: { rate: 5.0 },
                withStore: { rate: 5.0 }
            }
        };

        const destinations = {
            US: 'ë¯¸êµ­', CA: 'ìºë‚˜ë‹¤', GB: 'ì˜êµ­', DE: 'ë…ì¼', 
            FR: 'í”„ë‘ìŠ¤', IT: 'ì´íƒˆë¦¬ì•„', ES: 'ìŠ¤í˜ì¸', 
            EU: 'ê¸°íƒ€ ìœ ëŸ½ (ë…ì¼ ìš”ê¸ˆ)', AU: 'í˜¸ì£¼'
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            fetchExchangeRate();
            loadSavedRatesData();
            setupDragAndDrop();
        });

        // ì €ì¥ëœ ìš´ì„ ë°ì´í„° ë¡œë“œ
        function loadSavedRatesData() {
            try {
                const savedData = localStorage.getItem('egsRatesData');
                const lastUpdate = localStorage.getItem('egsRatesLastUpdate');
                
                if (savedData) {
                    egsRatesData = JSON.parse(savedData);
                    showUploadStatus(`âœ… ì €ì¥ëœ ìš´ì„í‘œ ë¡œë“œë¨ (${new Date(lastUpdate).toLocaleDateString()})`, 'success');
                } else {
                    showUploadStatus('âš ï¸ ìš´ì„í‘œë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”. ì—…ë¡œë“œí•˜ì§€ ì•Šìœ¼ë©´ ê³„ì‚°ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.', 'info');
                }
            } catch (error) {
                console.error('ì €ì¥ëœ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showUploadStatus('âŒ ì €ì¥ëœ ìš´ì„í‘œ ë¡œë“œ ì‹¤íŒ¨. ìƒˆë¡œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        function setupDragAndDrop() {
            const uploadSection = document.getElementById('uploadSection');
            
            uploadSection.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadSection.style.borderColor = '#0284c7';
                uploadSection.style.background = 'linear-gradient(135deg, #e0f2fe, #bae6fd)';
                uploadSection.style.transform = 'scale(1.02)';
            });
            
            uploadSection.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadSection.style.borderColor = '#0ea5e9';
                uploadSection.style.background = 'linear-gradient(135deg, #f0f9ff, #e0f2fe)';
                uploadSection.style.transform = 'scale(1)';
            });
            
            uploadSection.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadSection.style.borderColor = '#0ea5e9';
                uploadSection.style.background = 'linear-gradient(135deg, #f0f9ff, #e0f2fe)';
                uploadSection.style.transform = 'scale(1)';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload({ target: { files: files } });
                }
            });
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // íŒŒì¼ í˜•ì‹ ê²€ì¦
            const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                               'application/vnd.ms-excel'];
            if (!validTypes.includes(file.type)) {
                showUploadStatus('âŒ Excel íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤ (.xlsx, .xls)', 'error');
                return;
            }

            showUploadStatus('ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ ì¤‘...', 'info');

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // ì—‘ì…€ ë°ì´í„° íŒŒì‹±
                    const parsedData = parseExcelWorkbook(workbook);
                    
                    if (parsedData) {
                        egsRatesData = parsedData;
                        
                        // localStorageì— ì €ì¥
                        localStorage.setItem('egsRatesData', JSON.stringify(parsedData));
                        localStorage.setItem('egsRatesLastUpdate', new Date().toISOString());
                        
                        showUploadStatus(`âœ… ìš´ì„í‘œ ì—…ë¡œë“œ ì™„ë£Œ! (${file.name})`, 'success');
                    } else {
                        showUploadStatus('âŒ ìš´ì„í‘œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    }
                } catch (error) {
                    console.error('íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜:', error);
                    showUploadStatus('âŒ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨. ë‹¤ë¥¸ íŒŒì¼ì„ ì‹œë„í•´ë³´ì„¸ìš”.', 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // ì—‘ì…€ ì›Œí¬ë¶ íŒŒì‹±
        function parseExcelWorkbook(workbook) {
            try {
                const result = {
                    standard: {},
                    express: {}
                };

                // Standard ì‹œíŠ¸ë“¤ íŒŒì‹±
                result.standard = parseStandardSheets(workbook);
                
                // Express ì‹œíŠ¸ íŒŒì‹±
                result.express = parseExpressSheet(workbook);

                // ìµœì†Œí•œ í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ íƒ€ì…ì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                if (Object.keys(result.standard).length === 0 && Object.keys(result.express).length === 0) {
                    return null;
                }

                return result;
            } catch (error) {
                console.error('ì—‘ì…€ íŒŒì‹± ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // Standard ì‹œíŠ¸ë“¤ íŒŒì‹±
        function parseStandardSheets(workbook) {
            const standardData = {};
            
            try {
                // US ì‹œíŠ¸ íŒŒì‹±
                const usSheet = workbook.Sheets['eGS Standard - US'];
                if (usSheet) {
                    const usData = XLSX.utils.sheet_to_json(usSheet, { header: 1 });
                    standardData.US = parseStandardUSSheet(usData);
                }

                // CA ì‹œíŠ¸ íŒŒì‹±
                const caSheet = workbook.Sheets['eGS Standard - CA'];
                if (caSheet) {
                    const caData = XLSX.utils.sheet_to_json(caSheet, { header: 1 });
                    standardData.CA = parseStandardGenericSheet(caData, 7); // Row 7ë¶€í„° ì‹œì‘
                }

                // GB ì‹œíŠ¸ íŒŒì‹±
                const gbSheet = workbook.Sheets['eGS Standard - GB'];
                if (gbSheet) {
                    const gbData = XLSX.utils.sheet_to_json(gbSheet, { header: 1 });
                    standardData.GB = parseStandardGenericSheet(gbData, 7); // Row 7ë¶€í„° ì‹œì‘
                }

                // AU ì‹œíŠ¸ íŒŒì‹±
                const auSheet = workbook.Sheets['eGS Standard - AU'];
                if (auSheet) {
                    const auData = XLSX.utils.sheet_to_json(auSheet, { header: 1 });
                    standardData.AU = parseStandardGenericSheet(auData, 6); // Row 6ë¶€í„° ì‹œì‘
                }

                // EU ì‹œíŠ¸ íŒŒì‹± (ê° êµ­ê°€ë³„ ê°œë³„ íŒŒì‹±)
                const euSheet = workbook.Sheets['eGS Standard - EU'];
                if (euSheet) {
                    const euData = XLSX.utils.sheet_to_json(euSheet, { header: 1 });
                    const euCountriesData = parseStandardEUSheet(euData);
                    if (euCountriesData) {
                        // ê° êµ­ê°€ë³„ ë°ì´í„°ë¥¼ ê°œë³„ì ìœ¼ë¡œ í• ë‹¹
                        Object.keys(euCountriesData).forEach(countryCode => {
                            standardData[countryCode] = euCountriesData[countryCode];
                        });
                    }
                }

                return standardData;
            } catch (error) {
                console.error('Standard ì‹œíŠ¸ íŒŒì‹± ì˜¤ë¥˜:', error);
                return {};
            }
        }

        // Express ì‹œíŠ¸ íŒŒì‹±
        function parseExpressSheet(workbook) {
            const expressData = {};
            
            try {
                const expressSheet = workbook.Sheets['eGS Express'];
                if (!expressSheet) return {};

                const data = XLSX.utils.sheet_to_json(expressSheet, { header: 1 });
                
                // Zone í—¤ë” ì°¾ê¸° (Row 3)
                const zoneHeader = data[3];
                if (!zoneHeader) return {};

                // Zone ë§¤í•‘ (ìœ ëŸ½ì€ ëª¨ë‘ M Zone ê³µí†µ)
                const zoneMapping = {
                    'US': { zone: 'E', index: zoneHeader.indexOf('E') },
                    'CA': { zone: 'F', index: zoneHeader.indexOf('F') },
                    'GB': { zone: 'M', index: zoneHeader.indexOf('M') },
                    'AU': { zone: 'U', index: zoneHeader.indexOf('U') }
                };

                // ë°ì´í„° íŒŒì‹± (Row 5ë¶€í„° ì‹œì‘)
                for (let row = 5; row < data.length; row++) {
                    const rowData = data[row];
                    if (!rowData || typeof rowData[0] !== 'number') continue;
                    
                    const weight = rowData[0];
                    
                    Object.keys(zoneMapping).forEach(country => {
                        const { index } = zoneMapping[country];
                        if (index !== -1 && typeof rowData[index] === 'number') {
                            if (!expressData[country]) {
                                expressData[country] = [];
                            }
                            expressData[country].push({
                                weight: weight,
                                price: rowData[index]
                            });
                        }
                    });
                }

                // ëª¨ë“  ìœ ëŸ½ êµ­ê°€ë“¤ì€ M Zone(GB)ê³¼ ë™ì¼í•œ ìš”ê¸ˆ ì‚¬ìš©
                if (expressData.GB) {
                    expressData.DE = [...expressData.GB];
                    expressData.FR = [...expressData.GB];
                    expressData.IT = [...expressData.GB];
                    expressData.ES = [...expressData.GB];
                    expressData.EU = [...expressData.GB];
                }

                return expressData;
            } catch (error) {
                console.error('Express ì‹œíŠ¸ íŒŒì‹± ì˜¤ë¥˜:', error);
                return {};
            }
        }

        // Standard US ì‹œíŠ¸ íŒŒì‹±
        function parseStandardUSSheet(data) {
            const result = [];
            
            // Row 4ë¶€í„° ì‹œì‘, ì»¬ëŸ¼ 1=weight, ì»¬ëŸ¼ 2=price
            for (let row = 4; row < data.length; row++) {
                const rowData = data[row];
                if (!rowData || rowData.length < 3) continue;
                
                const weight = parseFloat(rowData[1]);
                const price = parseFloat(rowData[2]);
                
                if (!isNaN(weight) && !isNaN(price) && weight > 0 && price > 0) {
                    result.push({ weight, price });
                }
            }
            
            return result.length > 0 ? result : null;
        }

        // Standard ì¼ë°˜ ì‹œíŠ¸ íŒŒì‹± (CA, GB, AU)
        function parseStandardGenericSheet(data, startRow) {
            const result = [];
            
            // ì§€ì •ëœ í–‰ë¶€í„° ì‹œì‘, ì»¬ëŸ¼ 0=weight, ì»¬ëŸ¼ 1=price
            for (let row = startRow; row < data.length; row++) {
                const rowData = data[row];
                if (!rowData || rowData.length < 2) continue;
                
                const weight = parseFloat(rowData[0]);
                const price = parseFloat(rowData[1]);
                
                if (!isNaN(weight) && !isNaN(price) && weight > 0 && price > 0) {
                    result.push({ weight, price });
                }
            }
            
            return result.length > 0 ? result : null;
        }

        // Standard EU ì‹œíŠ¸ íŒŒì‹± (ê° êµ­ê°€ë³„ ê°œë³„ íŒŒì‹±)
        function parseStandardEUSheet(data) {
            const results = {};
            
            try {
                // Row 2ì—ì„œ ê° êµ­ê°€ ìœ„ì¹˜ ì°¾ê¸°
                const headerRow = data[2];
                if (!headerRow) return null;
                
                const countryMapping = {
                    'FR': 'France',
                    'DE': 'Germany', 
                    'IT': 'Italy',
                    'ES': 'Spain'
                };
                
                const countryIndices = {};
                Object.keys(countryMapping).forEach(code => {
                    const countryName = countryMapping[code];
                    for (let i = 0; i < headerRow.length; i++) {
                        if (headerRow[i] && headerRow[i].includes(countryName)) {
                            countryIndices[code] = i;
                            break;
                        }
                    }
                });
                
                // ê° êµ­ê°€ë³„ë¡œ ë°ì´í„° íŒŒì‹±
                Object.keys(countryIndices).forEach(countryCode => {
                    const columnIndex = countryIndices[countryCode];
                    const countryData = [];
                    
                    // Row 3ë¶€í„° ë°ì´í„° íŒŒì‹±
                    for (let row = 3; row < data.length; row++) {
                        const rowData = data[row];
                        if (!rowData || rowData.length <= columnIndex) continue;
                        
                        const weight = parseFloat(rowData[0]);
                        const price = parseFloat(rowData[columnIndex]);
                        
                        if (!isNaN(weight) && !isNaN(price) && weight > 0 && price > 0) {
                            countryData.push({ weight, price });
                        }
                    }
                    
                    if (countryData.length > 0) {
                        results[countryCode] = countryData;
                    }
                });
                
                // EU(ê¸°íƒ€ ìœ ëŸ½)ëŠ” ë…ì¼ ìš”ê¸ˆ ì‚¬ìš©
                if (results.DE) {
                    results.EU = [...results.DE];
                }
                
                return Object.keys(results).length > 0 ? results : null;
            } catch (error) {
                console.error('EU ì‹œíŠ¸ íŒŒì‹± ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ
        function showUploadStatus(message, type) {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.textContent = message;
            statusDiv.className = `upload-status ${type}`;
            statusDiv.classList.remove('hidden');
        }

        // ì‹¤ì‹œê°„ í™˜ìœ¨ ê°€ì ¸ì˜¤ê¸°
        async function fetchExchangeRate() {
            const refreshIcon = document.getElementById('refreshIcon');
            const exchangeRateDisplay = document.getElementById('exchangeRateDisplay');
            const lastUpdated = document.getElementById('lastUpdated');
            
            refreshIcon.innerHTML = '<div class="loading"></div>';
            
            try {
                const response = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent('https://api.exchangerate-api.com/v4/latest/USD'));
                const data = await response.json();
                
                if (data.rates && data.rates.KRW) {
                    currentExchangeRate = data.rates.KRW;
                    exchangeRateDisplay.textContent = `1 USD = ${currentExchangeRate.toLocaleString()}ì›`;
                    lastUpdated.textContent = `(${new Date().toLocaleTimeString()} ì—…ë°ì´íŠ¸)`;
                } else {
                    throw new Error('í™˜ìœ¨ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('í™˜ìœ¨ API ì˜¤ë¥˜:', error);
                exchangeRateDisplay.innerHTML = `
                    <input type="number" id="manualExchangeRate" value="1300" 
                           style="width: 80px; padding: 2px 6px; border: 1px solid #d1d5db; border-radius: 4px;"
                           onchange="updateManualExchangeRate(this.value)">ì› (ìˆ˜ë™ ì…ë ¥)
                `;
                lastUpdated.textContent = '(API ì˜¤ë¥˜ë¡œ ìˆ˜ë™ ì…ë ¥ ëª¨ë“œ)';
                currentExchangeRate = 1300;
            }
            
            refreshIcon.innerHTML = 'ğŸ”„';
        }

        // ìˆ˜ë™ í™˜ìœ¨ ì—…ë°ì´íŠ¸
        function updateManualExchangeRate(value) {
            const rate = parseFloat(value);
            if (rate && rate > 0) {
                currentExchangeRate = rate;
                document.getElementById('lastUpdated').textContent = `(${new Date().toLocaleTimeString()} ìˆ˜ë™ ì—…ë°ì´íŠ¸)`;
            }
        }

        // ë°°ì†¡ ì„œë¹„ìŠ¤ íƒ€ì… í† ê¸€
        function toggleServiceType(type) {
            currentServiceType = type;
            
            document.querySelectorAll('.service-type-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateWeightInfo();
        }

        // ë¶€í”¼ ì¤‘ëŸ‰ ê³„ì‚°
        function calculateVolumetricWeight() {
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            
            if (length && width && height) {
                return (length * width * height) / 6000;
            }
            return 0;
        }

        // ìµœì¢… ê³¼ê¸ˆ ì¤‘ëŸ‰ ê³„ì‚°
        function getFinalWeight() {
            const actualWeight = parseFloat(document.getElementById('weight').value) || 0;
            const volumetricWeight = calculateVolumetricWeight();
            return Math.max(actualWeight, volumetricWeight);
        }

        // eGS í•´ì™¸ë°°ì†¡ë¹„ ê³„ì‚° (ì—‘ì…€ ë°ì´í„° ì‚¬ìš©)
        function calculateEgsShipping(targetWeight, destination) {
            if (!egsRatesData) {
                return 0;
            }

            const serviceData = egsRatesData[currentServiceType];
            if (!serviceData || !serviceData[destination]) {
                return 0;
            }

            const rates = serviceData[destination];
            if (!rates || rates.length === 0) {
                return 0;
            }

            // ì •í™•í•œ ì¤‘ëŸ‰ ë§¤ì¹­
            const exactMatch = rates.find(rate => rate.weight === targetWeight);
            if (exactMatch) return exactMatch.price;

            // ë‹¤ìŒ ë†’ì€ ì¤‘ëŸ‰ ì°¾ê¸°
            const nextHigher = rates.find(rate => rate.weight > targetWeight);
            if (nextHigher) return nextHigher.price;

            // ìµœëŒ€ ì¤‘ëŸ‰ ì´ˆê³¼ ì‹œ ë³´ê°„
            const lastRate = rates[rates.length - 1];
            if (targetWeight > lastRate.weight) {
                const previousRate = rates[rates.length - 2] || lastRate;
                const weightDiff = targetWeight - lastRate.weight;
                const pricePerKg = (lastRate.price - previousRate.price) / (lastRate.weight - previousRate.weight);
                return Math.round(lastRate.price + (weightDiff * pricePerKg));
            }

            return 0;
        }

        // eBay ìˆ˜ìˆ˜ë£Œ ê³„ì‚°
        function calculateEbayFee(sellingPriceUSD, category, hasStore) {
            const categoryData = ebayCategories[category];
            const feeStructure = hasStore ? categoryData.withStore : categoryData.noStore;
            
            const transactionFee = sellingPriceUSD <= 10 ? 0.30 : 0.40;
            let percentageFee = 0;
            
            if (feeStructure.threshold) {
                const baseRate = feeStructure.rate / 100;
                const overRate = feeStructure.overRate / 100;
                const threshold = feeStructure.threshold;
                
                if (sellingPriceUSD <= threshold) {
                    percentageFee = sellingPriceUSD * baseRate;
                } else {
                    const baseFee = threshold * baseRate;
                    const overFee = (sellingPriceUSD - threshold) * overRate;
                    percentageFee = baseFee + overFee;
                }
            } else if (feeStructure.minAmount) {
                if (sellingPriceUSD >= feeStructure.minAmount) {
                    percentageFee = sellingPriceUSD * (feeStructure.rate / 100);
                } else {
                    percentageFee = sellingPriceUSD * (feeStructure.belowMinRate / 100);
                }
            } else if (feeStructure.threshold1) {
                const threshold1 = feeStructure.threshold1;
                const threshold2 = feeStructure.threshold2;
                const rate1 = feeStructure.rate1 / 100;
                const rate2 = feeStructure.rate2 / 100;
                const baseRate = feeStructure.rate / 100;
                
                if (sellingPriceUSD <= threshold1) {
                    percentageFee = sellingPriceUSD * baseRate;
                } else if (sellingPriceUSD <= threshold2) {
                    const baseFee = threshold1 * baseRate;
                    const midFee = (sellingPriceUSD - threshold1) * rate1;
                    percentageFee = baseFee + midFee;
                } else {
                    const baseFee = threshold1 * baseRate;
                    const midFee = (threshold2 - threshold1) * rate1;
                    const topFee = (sellingPriceUSD - threshold2) * rate2;
                    percentageFee = baseFee + midFee + topFee;
                }
            } else {
                percentageFee = sellingPriceUSD * (feeStructure.rate / 100);
            }
            
            return percentageFee + transactionFee;
        }

        // ëª©í‘œ ë§ˆì§„ìœ¨ ë‹¬ì„± íŒë§¤ê°€ ê³„ì‚° (ì´ë¶„íƒìƒ‰)
        function findTargetSellingPrice(totalCostUSD, targetMarginRate, category, hasStore, isKoreanSeller) {
            let low = totalCostUSD * 1.1;
            let high = totalCostUSD * 5.0;
            let bestPrice = high;
            
            for (let i = 0; i < 50; i++) {
                const midPrice = (low + high) / 2;
                
                const ebayFee = calculateEbayFee(midPrice, category, hasStore);
                const vat = isKoreanSeller ? ebayFee * 0.1 : 0;
                const totalFees = ebayFee + vat;
                
                const netProfit = midPrice - totalCostUSD - totalFees;
                const actualMarginRate = (netProfit / midPrice) * 100;
                
                if (Math.abs(actualMarginRate - targetMarginRate) < 0.01) {
                    bestPrice = midPrice;
                    break;
                }
                
                if (actualMarginRate < targetMarginRate) {
                    low = midPrice;
                } else {
                    high = midPrice;
                    bestPrice = midPrice;
                }
            }
            
            return bestPrice;
        }

        // ì¤‘ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateWeightInfo() {
            const volumetricWeight = calculateVolumetricWeight();
            const finalWeight = getFinalWeight();
            const weightInfo = document.getElementById('weightInfo');
            
            if (volumetricWeight > 0) {
                const serviceTypeText = currentServiceType === 'express' ? 'Express' : 'Standard';
                weightInfo.innerHTML = `
                    ğŸ“¦ ë¶€í”¼ ì¤‘ëŸ‰: ${volumetricWeight.toFixed(2)}kg | ê³¼ê¸ˆ ì¤‘ëŸ‰: ${finalWeight.toFixed(2)}kg<br>
                    ğŸšš ì„ íƒëœ ì„œë¹„ìŠ¤: eGS ${serviceTypeText}
                `;
                weightInfo.classList.remove('hidden');
            } else {
                weightInfo.classList.add('hidden');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('length').addEventListener('input', updateWeightInfo);
            document.getElementById('width').addEventListener('input', updateWeightInfo);
            document.getElementById('height').addEventListener('input', updateWeightInfo);
            document.getElementById('weight').addEventListener('input', updateWeightInfo);
        });

        // ë§ˆì§„ ê³„ì‚°
        function calculateMargin() {
            // ìš´ì„ ë°ì´í„° ì²´í¬
            if (!egsRatesData) {
                alert('âš ï¸ ìš´ì„í‘œë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!');
                return;
            }

            const productCost = document.getElementById('productCost').value;
            const supplierShipping = document.getElementById('supplierShipping').value || 0;
            const weight = document.getElementById('weight').value;
            const destination = document.getElementById('destination').value;
            const category = document.getElementById('category').value;
            const egsShipping = document.getElementById('egsShipping').value || 3400;
            const targetMargin = document.getElementById('targetMargin').value;
            const storeType = document.getElementById('storeType').value;
            const isKoreanSeller = document.getElementById('isKoreanSeller').value === 'true';

            if (!productCost || !destination || !category || !weight || !targetMargin) {
                alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const finalWeight = getFinalWeight();
            const egsShippingCost = calculateEgsShipping(finalWeight, destination);
            
            if (egsShippingCost === 0) {
                alert(`âš ï¸ ${destinations[destination]} ë°°ì†¡ë¹„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            const totalCostKRW = 
                parseFloat(productCost) + 
                parseFloat(supplierShipping) + 
                parseFloat(egsShipping) + 
                egsShippingCost;

            const totalCostUSD = totalCostKRW / currentExchangeRate;
            const hasStore = storeType !== 'none';
            const targetMarginRate = parseFloat(targetMargin);
            
            const requiredSellingPriceUSD = findTargetSellingPrice(
                totalCostUSD, 
                targetMarginRate, 
                category, 
                hasStore, 
                isKoreanSeller
            );
            
            const ebayFeeUSD = calculateEbayFee(requiredSellingPriceUSD, category, hasStore);
            const vatUSD = isKoreanSeller ? ebayFeeUSD * 0.1 : 0;
            const totalFeesUSD = ebayFeeUSD + vatUSD;
            
            const netProfitUSD = requiredSellingPriceUSD - totalCostUSD - totalFeesUSD;
            const netProfitKRW = netProfitUSD * currentExchangeRate;
            const actualMarginRate = (netProfitUSD / requiredSellingPriceUSD) * 100;

            displayResults({
                productCost: parseFloat(productCost),
                supplierShipping: parseFloat(supplierShipping),
                egsShipping: parseFloat(egsShipping),
                egsInternationalShipping: egsShippingCost,
                totalCostKRW: totalCostKRW,
                totalCostUSD: totalCostUSD,
                requiredSellingPriceUSD: requiredSellingPriceUSD,
                ebayFeeUSD: ebayFeeUSD,
                vatUSD: vatUSD,
                totalFeesUSD: totalFeesUSD,
                netProfitUSD: netProfitUSD,
                netProfitKRW: netProfitKRW,
                actualMarginRate: actualMarginRate,
                targetMarginRate: targetMarginRate,
                finalWeight: finalWeight,
                volumetricWeight: calculateVolumetricWeight(),
                exchangeRate: currentExchangeRate,
                hasStore: hasStore,
                isKoreanSeller: isKoreanSeller,
                destination: destination,
                category: category,
                serviceType: currentServiceType
            });
        }

        function displayResults(results) {
            const serviceName = results.serviceType === 'express' ? 'eGS Express í•´ì™¸ë°°ì†¡ë¹„' : 'eGS Standard í•´ì™¸ë°°ì†¡ë¹„';
            
            document.getElementById('costBreakdown').innerHTML = `
                <div class="result-item">
                    <span>ì œí’ˆ ì›ê°€:</span>
                    <span>${results.productCost.toLocaleString()}ì›</span>
                </div>
                <div class="result-item">
                    <span>ë§¤ì…ì²˜ ë°°ì†¡ë¹„:</span>
                    <span>${results.supplierShipping.toLocaleString()}ì›</span>
                </div>
                <div class="result-item">
                    <span>eGS ì°½ê³  ì…ê³ ë¹„:</span>
                    <span>${results.egsShipping.toLocaleString()}ì›</span>
                </div>
                <div class="result-item">
                    <span>${serviceName}:</span>
                    <span>${results.egsInternationalShipping.toLocaleString()}ì›</span>
                </div>
                <div class="result-item total text-red">
                    <span>ì´ ì›ê°€:</span>
                    <span>${results.totalCostKRW.toLocaleString()}ì›</span>
                </div>
            `;

            const marginText = Math.abs(results.actualMarginRate - results.targetMarginRate) < 0.1 
                ? `${results.actualMarginRate.toFixed(1)}% âœ…` 
                : `${results.actualMarginRate.toFixed(1)}% (ëª©í‘œ: ${results.targetMarginRate}%)`;

            document.getElementById('salesInfo').innerHTML = `
                <div class="result-item">
                    <span>ì‹¤ì‹œê°„ í™˜ìœ¨:</span>
                    <span>1 USD = ${results.exchangeRate.toLocaleString()}ì›</span>
                </div>
                <div class="result-item">
                    <span>ì´ ì›ê°€:</span>
                    <span>$${results.totalCostUSD.toFixed(2)}</span>
                </div>
                <div class="result-item">
                    <span>eBay ìˆ˜ìˆ˜ë£Œ:</span>
                    <span>$${results.ebayFeeUSD.toFixed(2)}</span>
                </div>
                ${results.isKoreanSeller ? `
                <div class="result-item">
                    <span>VAT (10%):</span>
                    <span>$${results.vatUSD.toFixed(2)}</span>
                </div>
                ` : ''}
                <div class="result-item text-red">
                    <span>ì´ ìˆ˜ìˆ˜ë£Œ:</span>
                    <span>$${results.totalFeesUSD.toFixed(2)}</span>
                </div>
                <div class="result-item total text-blue">
                    <span>ê¶Œì¥ íŒë§¤ê°€:</span>
                    <span>$${results.requiredSellingPriceUSD.toFixed(2)}</span>
                </div>
                <div class="result-item text-green">
                    <span>ìˆœìˆ˜ìµ:</span>
                    <span>$${results.netProfitUSD.toFixed(2)}</span>
                </div>
                <div class="result-item">
                    <span>ìˆœìˆ˜ìµ (ì›í™”):</span>
                    <span class="text-green">${results.netProfitKRW.toLocaleString()}ì›</span>
                </div>
                <div class="result-item text-green">
                    <span>ë‹¬ì„± ë§ˆì§„ìœ¨:</span>
                    <span>${marginText}</span>
                </div>
            `;

            const serviceTypeText = results.serviceType === 'express' 
                ? 'âš¡ eGS Express (2-5ì¼ ë°°ì†¡)' 
                : 'ğŸš› eGS Standard (5-10ì¼ ë°°ì†¡)';

            document.getElementById('settingsInfo').innerHTML = `
                <div style="font-size: 14px; line-height: 1.6;">
                    <div>ëª©ì ì§€: ${destinations[results.destination]}</div>
                    <div>ê³¼ê¸ˆ ì¤‘ëŸ‰: ${results.finalWeight}kg</div>
                    <div>ë°°ì†¡ ì„œë¹„ìŠ¤: ${serviceTypeText}</div>
                    <div>ì¹´í…Œê³ ë¦¬: ${ebayCategories[results.category].name}</div>
                    <div>ìŠ¤í† ì–´ êµ¬ë…: ${results.hasStore ? 'Basic ì´ìƒ' : 'ì—†ìŒ/Starter'}</div>
                    <div>íŒë§¤ì ìœ í˜•: ${results.isKoreanSeller ? 'í•œêµ­ íŒë§¤ì (VAT 10%)' : 'í•´ì™¸ íŒë§¤ì'}</div>
                    <div style="font-size: 12px; margin-top: 8px; padding: 8px; background-color: #eff6ff; border-radius: 4px;">
                        ğŸ’¡ v2.1 ìƒˆê¸°ëŠ¥: ì—‘ì…€ ê¸°ë°˜ ë™ì  ìš´ì„ ê´€ë¦¬ + ë¸Œë¼ìš°ì € ì €ì¥
                    </div>
                </div>
            `;

            document.getElementById('resultsContainer').classList.remove('hidden');
        }
    </script>
</body>
</html>
